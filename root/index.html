<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>시장님 집무실 · 스마트 미러 PRO</title>

  <!-- PWA & 아이콘 -->
  <link rel="manifest" href="/manifest.webmanifest" />
  <link rel="icon" sizes="192x192" href="/icon-192.png" />
  <link rel="icon" sizes="512x512" href="/icon-512.png" />
  <meta name="theme-color" content="#0b0f19" />

  <link rel="stylesheet" href="/style.css" />
  <style>
    :root { --card:#141a21; --muted:#8ea1b5; --accent:#3b82f6; --danger:#ef4444; }
    body{background:#0b0f19;color:#e5edf5;font-family:system-ui,Apple SD Gothic Neo,Segoe UI,Roboto,Arial}
    .container{max-width:1100px;margin:28px auto;padding:0 16px}
    .row{display:grid;gap:16px}
    .hero{display:flex;justify-content:space-between;align-items:flex-end;
          background:linear-gradient(135deg,#141a21 0%,#0f1520 100%);
          border-radius:18px;padding:22px 24px;box-shadow:0 6px 24px rgba(0,0,0,.25)}
    .hero h1{font-size:28px;margin:0 0 6px 0}
    .hero .sub{color:var(--muted);margin:0}
    .badge{border:1px solid rgba(255,255,255,.2);padding:6px 10px;border-radius:999px;color:#bfead9;font-size:13px}

    .card{background:var(--card);border-radius:18px;padding:18px 18px 16px;box-shadow:0 6px 24px rgba(0,0,0,.25)}
    .card h3{margin:2px 0 12px 2px}
    .kv{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    .kv div{background:#0f1520;border:1px solid rgba(255,255,255,.06);padding:12px;border-radius:12px}
    .kv .v{font-size:28px}
    .btn{background:#1a2430;border:1px solid rgba(255,255,255,.18);padding:10px 14px;border-radius:12px;cursor:pointer}
    .btn:hover{background:#223042}
    .btn.primary{background:var(--accent);border:none;color:white}
    .btn.danger{background:#2a0e10;border:1px solid #7a1b23}
    .row-2{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:960px){ .row-2{grid-template-columns:1fr 1fr} }

    .chat{height:240px;overflow:auto;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px;background:#0f1520}
    .bubble{max-width:90%;margin:6px 0;padding:12px;border-radius:14px;line-height:1.5}
    .bubble.bot
{background:#16202c;color:#e6f0ff}
    .bubble.user
{margin-left:auto;background:#2b3b4e}
    .chat-form{display:flex;gap:8px;margin-top:10px}
    .chat-input{flex:1;border:1px solid rgba(255,255,255,.15);border-radius:12px;background:#0f1520;color:#dfe8f5;padding:12px 12px}
    .opt{display:flex;flex-wrap:wrap;gap:8px;align-items:center;color:#a9b8c8;margin-top:8px}
    .mic-big{font-size:22px;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.18);background:#1a2430}

    .footer{opacity:.7;margin:16px 2px 32px 2px}
    .error-badge{position:fixed;right:12px;bottom:12px;background:#ff4d4f;color:#fff;padding:8px 10px;border-radius:8px;font-size:12px;display:none;z-index:9999}
  </style>
</head>
<body>
  <main class="container">
    <!-- 상단 인사/시계 -->
    <section class="hero">
      <div>
        <h1 id="greet">시장님 안녕하세요</h1>
        <p class="sub" id="today">YYYY.MM.DD (요일)</p>
      </div>
      <div>
        <div class="badge">루미나 스마트 비서</div>
      </div>
    </section>

    <!-- 날씨 -->
    <section class="card" id="weatherCard">
      <h3>현재 날씨</h3>
      <div class="kv" style="margin-bottom:10px">
        <div><div style="color:var(--muted)">온도</div><div id="w-temp" class="v">- °C</div></div>
        <div><div style="color:var(--muted)">습도</div><div id="w-hum" class="v">- %</div></div>
        <div><div style="color:var(--muted)">강수</div><div id="w-rain" class="v">- mm</div></div>
        <div><div style="color:var(--muted)">풍속</div><div id="w-wind" class="v">- m/s</div></div>
      </div>
      <button class="btn" id="btnWeather">날씨 업데이트</button>
    </section>

    <div class="row-2">
      <!-- AI 비서 (채팅 + 음성) -->
      <section class="card">
        <h3>AI 비서 채팅</h3>
        <div id="chat" class="chat">
          <div class="bubble bot">안녕하세요, 시장님. 무엇을 도와드릴까요?</div>
        </div>
        <form id="chatForm" class="chat-form">
          <button type="button" id="micBtn" class="mic-big" title="음성으로 말하기">🎙️</button>
          <input id="msgInput" class="chat-input" type="text" placeholder="메시지를 입력하세요. (예: 오늘 일정 요약)" autocomplete="off" />
          <button type="submit" class="btn primary">보내기</button>
        </form>
        <div class="opt">
          <label><input type="checkbox" id="ttsToggle" checked /> 응답을 음성으로 읽기</label>
          <button id="ttsPause" class="btn">⏸︎ 일시정지</button>
          <button id="ttsResume" class="btn">▶︎ 재개</button>
          <button id="ttsStop" class="btn danger">■ 정지</button>
          <span style="margin-left:auto;color:#7d8b9a">※ 특수문자/이모지/마크다운은 읽기 전에 자동 정리</span>
        </div>
      </section>

      <!-- 실시간 통역(듀얼 모드) -->
      <section class="card">
        <h3>실시간 통역</h3>
        <div class="opt">
          <label>입력(말하기) 언어
            <select id="langIn">
              <option value="ko">한국어</option>
              <option value="en">English</option>
              <option value="ja">日本語</option>
              <option value="zh">中文</option>
            </select>
          </label>
          <label>출력(읽어주기) 언어
            <select id="langOut">
              <option value="ko">한국어</option>
              <option value="en">English</option>
              <option value="ja">日本語</option>
              <option value="zh">中文</option>
            </select>
          </label>
          <button id="trStart" class="btn">🎤 통역 시작</button>
          <button id="trStop" class="btn danger">■ 통역 정지</button>
        </div>
        <div id="trLog" class="chat" style="height:180px;margin-top:8px"></div>
      </section>
    </div>

    <footer class="footer">© 논산시 스마트미러 · 루미나 PRO</footer>
  </main>

  <div id="errorBadge" class="error-badge">문제 감지 · 팀에 보고됨</div>

  <!-- 메인 로직 -->
  <script type="module" src="/ai.js"></script>

  <script>
    // 오류 배지
    addEventListener('error', ()=> document.getElementById('errorBadge').style.display='block');
    addEventListener('unhandledrejection', ()=> document.getElementById('errorBadge').style.display='block');

    // 시계
    const todayEl = document.getElementById('today');
    function tick(){
      const now=new Date();
      const d=now.toLocaleDateString
('ko-KR',{year:'numeric',month:'2-digit',day:'2-digit',weekday:'long'});
      todayEl.textContent=d;
    }
    setInterval(tick,1000); tick();
  </script>
</body>
</html>
