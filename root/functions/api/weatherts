export async function onRequest({ request, env }: { request: Request; env: any }) {
  try {
    const url = new URL(request.url);
    const nx = url.searchParams.get('nx') ?? '60';
    const ny = url.searchParams.get('ny') ?? '127';
    const key = env.KMA_SERVICE_KEY;

    if (!key) {
      return Response.json({ summary: '기상청 키 미설정. 맑음 25℃ (표시용)' });
    }

    // 간단화: 서버에서 KMA 중계 서비스(예: 변환된 요약 API)를 호출한다고 가정
    // 실제 사용 시, UltraSrtNcst/UltraSrtFcst 조합으로 요약문 생성
    const resp = await fetch(`https://portal.local-kma-proxy.example/summary?nx=
${nx}&ny=${ny}&key=${encodeURIComponent(key)}`);
    if (!resp.ok) throw new Error('KMA fail');
    const data = await resp.json();
    return Response.json({ summary: data.summary ?? '날씨 정보 준비 중' });
  } catch {
    return Response.json({ summary: '날씨 정보를 불러올 수 없습니다.' });
  }
}
