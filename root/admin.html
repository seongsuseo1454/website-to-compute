<!doctype html>
<html lang="ko"><head>
<meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" />
<title>관리자 입력 · 스마트미러</title>
<link rel="stylesheet" href="/style.css" />
</head>
<body>
<main class="container">
  <section class="card">
    <header class="card-title">관리자 로그인</header>
    <input id="admTok" placeholder="ADMIN_TOKEN" class="input" />
  </section>

  <section class="grid">
    <div class="card">
      <header class="card-title">오늘 일정 추가</header>
      <input id="s_time" placeholder="예: 10:00" class="input" />
      <input id="s_title" placeholder="제목" class="input" />
      <input id="s_loc" placeholder="장소(선택)" class="input" />
      <button class="primary" onclick="saveSched()">저장</button>
      <button class="ghost" onclick="loadList('SCHEDULE:TODAY','#list1')">불러오기</button>
      <ul id="list1" class="feed" style="margin-top:8px"></ul>
    </div>

    <div class="card">
      <header class="card-title">시정 뉴스 추가</header>
      <input id="n_title" placeholder="제목" class="input" />
      <input id="n_src" placeholder="출처/부서" class="input" />
      <button class="primary" onclick="saveNews()">저장</button>
      <button class="ghost" onclick="loadList('NEWS','#list2')">불러오기</button>
      <ul id="list2" class="feed" style="margin-top:8px"></ul>
    </div>

    <div class="card">
      <header class="card-title">부서별 업무보고 추가</header>
      <input id="d_title" placeholder="보고 제목" class="input" />
      <input id="d_dept" placeholder="부서명" class="input" />
      <button class="primary" onclick="saveDept()">저장</button>
      <button class="ghost" onclick="loadList('DEPT','#list3')">불러오기</button>
      <ul id="list3" class="feed" style="margin-top:8px"></ul>
    </div>
  </section>
</main>

<script>
async function kvPush(kind, payload){
  const token = document.getElementById('admTok').value.trim();
  const res = await fetch('/api/admin',{ method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ token, kind, payload })});
  const j = await res.json(); alert(j.msg||'완료'); 
}
async function loadList(listKey, sel){
  const res = await fetch('/api/admin?list='+encodeURIComponent(listKey));
  const arr = await res.json(); const box=document.querySelector(sel); box.innerHTML
='';
  if(!arr.length){ const li=document.createElement('li'); li.className='empty'; li.textContent='없음'; box.appendChild
(li); return;}
  for(const it of arr){
    const li=document.createElement('li'); li.innerHTML=`<div class="feed-title">${it.title||it.text}</div><div class="feed-sub">${it.time||it.source||it.dept||''}</div>`; box.appendChild
(li);
  }
}
function saveSched(){ kvPush('SCHEDULE:TODAY',{ time: document.getElementById('s_time').value, title: document.getElementById('s_title').value, location: document.getElementById('s_loc').value }); }
function saveNews(){ kvPush('NEWS',{ title: document.getElementById('n_title').value, source: document.getElementById('n_src').value }); }
function saveDept(){ kvPush('DEPT',{ title: document.getElementById('d_title').value, dept: document.getElementById('d_dept').value }); }
</script>
</body></html>
